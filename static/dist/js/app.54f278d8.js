(function(t){function e(e){for(var a,s,o=e[0],l=e[1],c=e[2],u=0,p=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&p.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);h&&h(e);while(p.length)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},r={app:0},i=[];function s(t){return o.p+"js/"+({}[t]||t)+"."+{"chunk-2d22d746":"44d6ec6a"}[t]+".js"}function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var a=new Promise((function(e,a){n=r[t]=[e,a]}));e.push(n[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=s(t);var c=new Error;i=function(e){l.onerror=l.onload=null,clearTimeout(u);var n=r[t];if(0!==n){if(n){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,n[1](c)}r[t]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:l})}),12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(e)},o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/",o.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var u=0;u<l.length;u++)e(l[u]);var h=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"034f":function(t,e,n){"use strict";n("85ec")},"1fd1":function(t,e,n){t.exports={spectro:"SingleElement_spectro_8bYiQ"}},"3a84":function(t,e,n){"use strict";n("987b")},"73d1":function(t,e,n){"use strict";var a=n("ebb4"),r=n.n(a);n.d(e,"default",(function(){return r.a}))},"85ec":function(t,e,n){},"97b9":function(t,e,n){t.exports={player:"SingleElementDetail_player_32IT7",image_container:"SingleElementDetail_image_container_3EQyS"}},"987b":function(t,e,n){},"99ef":function(t,e,n){"use strict";var a=n("97b9"),r=n.n(a);n.d(e,"default",(function(){return r.a}))},"9a51":function(t,e,n){"use strict";var a=n("1fd1"),r=n.n(a);n.d(e,"default",(function(){return r.a}))},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("img",{attrs:{src:n("cf05"),alt:"logo"}}),a("router-view"),a("router-link",{attrs:{to:"/"}},[t._v("Home")]),t._v(" - "),a("router-link",{attrs:{to:"/about"}},[t._v("About")])],1)},i=[],s=n("d4ec"),o=n("262e"),l=n("2caf"),c=n("9ab4"),u=n("60a3"),h=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){return Object(s["a"])(this,n),e.apply(this,arguments)}return n}(u["c"]);h=Object(c["a"])([Object(u["a"])({components:{}})],h);var p=h,d=p,f=(n("034f"),n("2877")),v=Object(f["a"])(d,r,i,!1,null,null,null),m=v.exports,_=n("e0ec"),b=n.n(_),g=(n("d3b7"),n("8c4f")),y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("h1",[t._v("New Spectrogram ?")]),n("NewSpectralForm",{on:{finished:t.update_list}}),n("SpectralAnalysisFlowList",{attrs:{"element-list":t.last_elements},on:{click:t.onClick}})],1)},j=[],w=n("bee2"),O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[t._m(0),t._l(t.groupedElements(),(function(e,a){return n("div",{key:a,staticClass:"row"},t._l(e,(function(e){return n("div",{key:e.id,staticClass:"col-sm-5 m-1"},[n("SingleElement",{attrs:{element:e},on:{click:t.onClick}})],1)})),0)}))],2)},k=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"row d-flex"},[n("div",{staticClass:"col align-self-center"},[n("h1",[t._v("LAST SPECTROGRAMS")])])])}],x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card"},[n("div",{staticClass:"card-header",on:{click:function(e){return t.$emit("click",t.element)}}},[n("a",{attrs:{href:"#"}},[t._v(t._s(t.element.title))])]),n("div",{staticClass:"card-body"},[n("img",{attrs:{src:t.thumbnail_url(),alt:t.element.parameters.youtube_url}}),n("div",[n("img",{class:t.$style.spectro,attrs:{src:t.first_tile_url(),height:"150"}})])])])},C=[],S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.image_container},[n("canvas",{ref:"theCanvas",class:t.$style.spectrogram})])},E=[],$=(n("4ec9"),n("3ca3"),n("ddb0"),n("96cf"),n("1da1")),q=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.images=new Array,t.loadingImages=new Map,t}return Object(w["a"])(n,[{key:"mounted",value:function(){var t=this.$refs.theCanvas;t.width=this.width,t.height=this.height,this.context=t.getContext("2d"),this.canvas=t,this.scrollTo(0)}},{key:"drawLineAt",value:function(t){this.context.moveTo(t,0),this.context.lineTo(t,this.canvas.height),this.context.strokeStyle="red",this.context.stroke()}},{key:"requestFullScreen",value:function(){var t=this,e=this.canvas.width,n=this.canvas.height;this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.requestFullscreen({}),this.canvas.addEventListener("fullscreenchange",(function(){null==document.fullscreenElement&&(t.canvas.height=n,t.canvas.width=e,t.canvas.style.width=t.canvas.width+"px",t.canvas.style.height=t.canvas.height+"px")}))}},{key:"clear",value:function(){this.loadingImages.clear(),this.images=[]}},{key:"scrollTo",value:function(t){for(var e=this,n=Math.floor(t/this.tile_width),a=Math.floor((t+this.canvas.width)/this.tile_width),r=function(n){null!=e.images[n]||e.loadingImages.has(n)||(e.loadingImages.set(n,!1),e.getImage(n).then((function(a){e.images[n]=a,e.loadingImages.set(n,!0),e.scrollTo(t)})))},i=n;i<=a;++i)r(i);1==this.loadingImages.get(n)&&this.context.drawImage(this.images[n],0,this.tile_height-this.canvas.height,this.tile_width,this.canvas.height,-t%this.tile_width+this.canvas.width/2,0,this.tile_width,this.canvas.height);for(var s=1,o=n+1;o<=a;o++)this.loadingImages.get(o)&&this.context.drawImage(this.images[o],0,this.tile_height-this.canvas.height,this.tile_width,this.canvas.height,-t%this.tile_width+this.canvas.width/2+s*this.tile_width,0,this.tile_width,this.canvas.height),s++;this.drawLineAt(this.canvas.width/2)}},{key:"getImage",value:function(){var t=Object($["a"])(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){var r=new Image;r.onload=function(){console.log("loaded tile ",e),t(r)},r.onerror=a,r.src=n.image_url_base+e+".png"})));case 1:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()}]),n}(u["c"]);Object(c["a"])([Object(u["b"])({required:!0})],q.prototype,"image_url_base",void 0),Object(c["a"])([Object(u["b"])({required:!0})],q.prototype,"width",void 0),Object(c["a"])([Object(u["b"])({required:!0})],q.prototype,"height",void 0),Object(c["a"])([Object(u["b"])({required:!0})],q.prototype,"tile_width",void 0),Object(c["a"])([Object(u["b"])({required:!0})],q.prototype,"tile_height",void 0),q=Object(c["a"])([Object(u["a"])({})],q);var T=q,P=T,z=n("73d1");function L(t){this["$style"]=z["default"].locals||z["default"]}var I=Object(f["a"])(P,S,E,!1,L,null,null),A=I.exports,F=n("9fab"),R=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){return Object(s["a"])(this,n),e.apply(this,arguments)}return Object(w["a"])(n,[{key:"thumbnail_url",value:function(){var t=F(this.element.parameters.youtube_url);return"https://img.youtube.com/vi/"+t+"/0.jpg"}},{key:"first_tile_url",value:function(){return this.make_url("https://sound-visualizer-api.projects.luc-leonard.fr")+"/0.png"}},{key:"make_url",value:function(t){return t+"/tiles/"+this.element.id+"/"}}]),n}(u["c"]);Object(c["a"])([Object(u["b"])({required:!0})],R.prototype,"element",void 0),R=Object(c["a"])([Object(u["a"])({components:{ScrollingCanvas:A}})],R);var M=R,N=M,D=n("9a51");function H(t){this["$style"]=D["default"].locals||D["default"]}var J=Object(f["a"])(N,x,C,!1,H,null,null),U=J.exports,Q=n("2ef0"),W=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){return Object(s["a"])(this,n),e.apply(this,arguments)}return Object(w["a"])(n,[{key:"groupedElements",value:function(){return Q.chunk(this.elementList,2)}},{key:"onClick",value:function(t){this.$emit("click",t)}}]),n}(u["c"]);Object(c["a"])([Object(u["b"])({required:!0})],W.prototype,"elementList",void 0),W=Object(c["a"])([Object(u["a"])({components:{SingleElement:U}})],W);var G=W,Y=G,B=(n("3a84"),Object(f["a"])(Y,O,k,!1,null,"b7c8a332",null)),K=B.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"new-spectral-form container"},[n("div",{staticClass:"mb-5 gx-1"},[n("form",[n("div",{},[n("span",{staticClass:"form-label"},[t._v("URL")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}})]),n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-6"},[n("span",{staticClass:"form-label"},[t._v("frame size")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.frame_size,expression:"frame_size"}],staticClass:"form-control",domProps:{value:t.frame_size},on:{input:function(e){e.target.composing||(t.frame_size=e.target.value)}}})]),n("div",{staticClass:"col-md-6"},[n("span",{staticClass:"form-label"},[t._v("overlap factor")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.overlap_factor,expression:"overlap_factor"}],staticClass:"form-control",domProps:{value:t.overlap_factor},on:{input:function(e){e.target.composing||(t.overlap_factor=e.target.value)}}})])]),n("button",{staticClass:"btn btn-primary",on:{click:t.compute}},[t._v("COMPUTE")])])])])},X=[],Z=n("bc3a"),tt=n.n(Z),et=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.url="https://youtube.com/...",t.frame_size=12,t.overlap_factor=.8,t.compute_result="",t}return Object(w["a"])(n,[{key:"compute",value:function(){var t=this;console.log(this),tt.a.post("https://sound-visualizer-api.projects.luc-leonard.fr/requests/",{youtube_url:this.url,frame_size_power:this.frame_size,overlap_factor:this.overlap_factor}).then((function(e){t.current_result_id=e.data.id,t.poll_result()}))}},{key:"poll_result",value:function(){var t=this;setTimeout((function(){tt.a.get("https://sound-visualizer-api.projects.luc-leonard.fr/request/"+t.current_result_id).then((function(e){"finished"==e.data.status?t.$emit("finished",{new_result:e.data}):(t.compute_result=JSON.stringify(e.data),t.poll_result())}))}),150)}}]),n}(u["c"]);et=Object(c["a"])([Object(u["a"])({components:{}})],et);var nt=et,at=nt,rt=Object(f["a"])(at,V,X,!1,null,"737c5ade",null),it=rt.exports,st=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.last_elements=[],t}return Object(w["a"])(n,[{key:"onClick",value:function(t){console.log(t),this.$router.push({name:"render",params:{result_id:t.id}})}},{key:"update_list",value:function(){var t=this;tt.a.get("https://sound-visualizer-api.projects.luc-leonard.fr/requests/?status=finished").then((function(e){t.last_elements=e.data}))}},{key:"mounted",value:function(){this.update_list()}}]),n}(a["a"]);st=Object(c["a"])([Object(u["a"])({components:{SpectralAnalysisFlowList:K,NewSpectralForm:it}})],st);var ot=st,lt=ot,ct=Object(f["a"])(lt,y,j,!1,null,null,null),ut=ct.exports,ht=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("h1",[t._v("Last spectrograms")]),n("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:t.close}},[n("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])]),null!=t.element?n("SingleElementDetail",{attrs:{element:t.element}}):t._e()],1)},pt=[],dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.element},[n("youtube",{ref:"youtube",class:t.$style.player,attrs:{"video-id":t.get_youtube_id(),"player-vars":t.players_vars},on:{paused:t.onPause,playing:t.playing}}),n("div",[t._v(t._s(t.fps))]),n("div",{on:{click:t.full_screen}},[t._v("[F U L L S C R E E N]")]),n("ScrollingCanvas",{ref:"spectro",staticClass:"image_container",attrs:{width:"2000",height:t.element.result.height/8,tile_width:t.element.result.tile_width,tile_height:t.element.result.height,image_url_base:t.make_url()}})],1)},ft=[],vt=n("9fab"),mt=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.players_vars={origin:window.location},t.player_start_time=0,t.current_time_when_starting_to_play=0,t.current_position=0,t.pixel_per_sec=-1,t.is_playing=!1,t.last_called_time=0,t.fps=0,t}return Object(w["a"])(n,[{key:"mounted",value:function(){this.spectro=this.$refs.spectro,this.current_position=0,this.pixel_per_sec=this.element.result.width/this.element.duration*1e3,this.spectro.clear(),this.spectro.scrollTo(0)}},{key:"playing",value:function(){var t=Object($["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("play"),this.is_playing=!0,this.current_time_when_starting_to_play=performance.now(),t.next=5,this.player().getCurrentTime().then((function(t){e.player_start_time=1e3*t}));case 5:requestAnimationFrame(this.update_position);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"onPause",value:function(){console.log("pause"),this.is_playing=!1}},{key:"update_position",value:function(){var t=Object($["a"])(regeneratorRuntime.mark((function t(e){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=(e-this.last_called_time)/1e3,this.last_called_time=e,this.fps=1/n,this.is_playing&&(a=e-this.current_time_when_starting_to_play,this.current_position=(a+this.player_start_time)/1e3,this.spectro.scrollTo(this.current_position*(this.pixel_per_sec/1e3)),requestAnimationFrame(this.update_position));case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"full_screen",value:function(){this.spectro.requestFullScreen()}},{key:"get_youtube_id",value:function(){return vt(this.element.parameters.youtube_url)}},{key:"make_url",value:function(){return"https://sound-visualizer-api.projects.luc-leonard.fr/tiles/"+this.element.id+"/"}},{key:"player",value:function(){if(!this.youtube_player){var t=this.$refs.youtube;this.youtube_player=t.player}return this.youtube_player}}]),n}(u["c"]);Object(c["a"])([Object(u["b"])({required:!0})],mt.prototype,"element",void 0),mt=Object(c["a"])([Object(u["a"])({components:{ScrollingCanvas:A}})],mt);var _t=mt,bt=_t,gt=n("99ef");function yt(t){this["$style"]=gt["default"].locals||gt["default"]}var jt=Object(f["a"])(bt,dt,ft,!1,yt,null,null),wt=jt.exports,Ot=function(t){Object(o["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(s["a"])(this,n),t=e.apply(this,arguments),t.element=null,t}return Object(w["a"])(n,[{key:"close",value:function(){this.$router.push({path:"/"})}},{key:"mounted",value:function(){var t=this;console.log(this.$route),tt.a.get("https://sound-visualizer-api.projects.luc-leonard.fr/request/"+this.$route.params["result_id"]).then((function(e){t.element=e.data}))}}]),n}(a["a"]);Ot=Object(c["a"])([Object(u["a"])({components:{SingleElementDetail:wt}})],Ot);var kt=Ot,xt=kt,Ct=Object(f["a"])(xt,ht,pt,!1,null,null,null),St=Ct.exports;a["a"].use(g["a"]);var Et=[{path:"/",name:"Home",component:ut},{name:"render",path:"/render/:result_id",component:St},{path:"/about",name:"About",component:function(){return n.e("chunk-2d22d746").then(n.bind(null,"f820"))}}],$t=new g["a"]({mode:"history",base:"/",routes:Et}),qt=$t;a["a"].config.productionTip=!1,a["a"].use(b.a);new a["a"]({render:function(t){return t(m)},router:qt}).$mount("#app")},cf05:function(t,e,n){t.exports=n.p+"img/logo.82b9c7a5.png"},ebb4:function(t,e,n){t.exports={image_container:"ScrollingCanvas_image_container_eSwc5",spectrogram:"ScrollingCanvas_spectrogram_25_Et"}}});
//# sourceMappingURL=app.54f278d8.js.map